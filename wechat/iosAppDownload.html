<!DOCTYPE html>
<html lang="en">
<head>
  <title>app下载</title>
  <meta charset="utf-8" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta property="og:type" content="webpage">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no minimal-ui">
  <style>
    html {
        font-size: 62.5%;
    }
    html,body{
      width: 100%;
      height: 100%;
    }
    
    body {
        margin: 0 auto;
        padding: 0;
        background-color: #fbfbfb;
    }
    .container{
      width: 100%;
      height: 100%;
      /*overflow: scroll;*/
    }
    .container_bg{
      width: 100%;
    }
    .container_bg img{
      width: 100%;
    }
    .container_logo{
      width: 160px;
      height: 160px;
      margin: 30px auto;
      background: url('image/iosAppBorder.png') no-repeat center center;
      background-size: 100%;
    }
    .container_logo img{
      width: 100px;
      border-radius: 24px;
      margin: 30px;
    }
    .container_name h2{
      font-size: 24px; 
      height: 33px;
      line-height: 33px;
      margin-bottom: -5px;
      text-align: center;
    }
    .container_name h2 img{
      height: 20px;
      position: relative;
      top: 2px;
      right: 3px;
    }
    .container_name_appname{
      color:#333;
      font-size:24px;
      font-weight: normal;
    }
    .container_name_appclass{
      color: #fff;
      border-radius: 5px; 
      font-size: 12px;
      font-weight: 400;
      padding: 3px 7px;
      background-color: #40acf1;
      position: relative;
      margin-top: 6px;
      margin-left: 8px;
      top: -4px;
    }
    .container_describe ul{
      width: 100%;
      text-align: center;
      padding: 0;
    }
    .container_describe ul li{
      list-style: none;
      display: inline-block;
      font-size: 14px;
      line-height: 1.6;
      color: #969b9d;
      padding: 0 10px;
    }
    .container_qrcode{
      text-align: center;
    }
    .container_qrcode img{
      width: 110px;
      height: 110px;
      border: 1px solid #c2c2c2;
      padding: 3px;
      margin-bottom: 30px;
      cursor: pointer;
      transition: all 0.25s;
    }
    .container_qrcode img:hover {
      transform: scale(1.4);
      box-shadow: 0 0 10px rgba(21, 21, 21, 0.2);
      border: none;
    }
    .container_ios_solution{
      text-align: center;
      padding: 20px;
      color: #1abc9c;
      padding-right: 5px;
    }
    .container_install{
      text-align: center;
      width: 150px;
      margin-bottom: 20px;
      font-size: 18px;
      background-color: #28caad;
      border-radius: 10px;
      color: #fff;
      padding: 10px;
      margin: 10px auto;
    }
    .modal-dialog img{
      width: 80%;
      display: block;
      margin: 0 auto;
    }

  </style>
</head>	
<body>
<div class="container"> 	
  <div class="container_bg">
    <img src="image/iosAppBg.png">
  </div>
  <div class="container_logo">
    <img src="image/iosAppLogo.png">
  </div>
  <div class="container_name">
    <h2>
      <img src="image/appDownloadAndroid.png">
      <span class="container_name_appname">在线法律</span>
      <span class="container_name_appclass">企业版</span>
    </h2>
  </div>
  <div class="container_describe">
    <ul>
      <li>版本：<span class="container_describe_cersion">1.0.0</span> </li>
      <li>大小：<span class="container_describe_size">31.1</span> MB</li>
      <li>更新时间：<span class="container_describe_time">2018-03-18</span></li>
    </ul>
  </div>
  <!-- <div class="container_qrcode">
    <img src="image/appDownloadIos.jpg"/>
  </div> -->
  <div style="display:none" class="container_downloadUrl"></div>

  
  <div>
    <p class="container_install">点击安装</p>
  </div>
  <div class="container_ios_tips">
    <div class="container_ios_solution">
      "未受信任的企业级开发者"的解决办法      
  </div>
  <div class="modal-dialog">
  <div class="modal-body">
    <section>
      <div style="padding:0 20px 20px;color:#333;">
        <p>因苹果公司的政策原因，在iOS系统中首次使用企业版应用时会出现"未受信任的企业级开发者"提示</p>
      </div>
      <div style="padding:0 10px 20px;">
        <img class="img-responsive center-block" src="image/001.png" style="width:80%;">
        <br/>
        <h4 class="font-16">解决办法如下（以iOS11系统为例）：</h4>
        <li style="list-style:none;color:#333;">1、在手机中打开设置功能，选择"通用"</li>
        <img class="img-responsive center-block mt-20 mb-20" src="image/002.png" style="width:80%;">
        <li style="list-style:none;color:#333;">2、在通用中，选择"描述文件与设备管理"功能</li>
        <img class="img-responsive center-block mt-20 mb-20" src="image/003.png" style="width:80%;">
        <li style="list-style:none;color:#333;">3、在描述文件与设备管理中的企业级应用分类中，选择要安装的企业应用的文件名称（与打开时的提示一致），点击进入</li>
        <img class="img-responsive center-block mt-20 mb-20" src="image/004.png" style="width:80%;">
        <li style="list-style:none;color:#333;">4、进入企业签名页面后，确认企业签名中的公司名称与应用名称后，点击信任"企业签名公司名称"</li>
        <img class="img-responsive center-block mt-20 mb-20" src="image/005.png" style="width:80%;">
        <img class="img-responsive center-block mt-20 mb-20" src="image/006.png" style="width:80%;">
        <li style="list-style:none;color:#333;">5、回到桌面，重新打开应用即可使用</li>
        <br/>
      </div>
    </section>
  </div>
</div>
  </div>
  
</div>





 
<script src="lib/jquery.min.js"></script>
<script type="text/javascript">
// 获取URL地址参数
function getUrlParams(p) {
  var url = location.href;
  var paraString = url.substring(url.indexOf("?") + 1, url.length).split("&");
  var paraObj = {};
  for (i = 0; j = paraString[i]; i++) {
      paraObj[j.substring(0, j.indexOf("=")).toLowerCase()] = j.substring(j.indexOf("=") + 1, j.length);
  }
  var returnValue = paraObj[p.toLowerCase()];
  if (typeof(returnValue) == "undefined") {
      return "";
  } else {
      return returnValue;
  }
}
//时间格式化
Date.prototype.Format = function(fmt)   
{ //author: meizz   
  var o = {   
    "M+" : this.getMonth()+1,                 //月份   
    "d+" : this.getDate(),                    //日   
    "h+" : this.getHours(),                   //小时   
    "m+" : this.getMinutes(),                 //分   
    "s+" : this.getSeconds(),                 //秒   
    "q+" : Math.floor((this.getMonth()+3)/3), //季度   
    "S"  : this.getMilliseconds()             //毫秒   
  };   
  if(/(y+)/.test(fmt))   
    fmt=fmt.replace(RegExp.$1, (this.getFullYear()+"").substr(4 - RegExp.$1.length));   
  for(var k in o)   
    if(new RegExp("("+ k +")").test(fmt))   
  fmt = fmt.replace(RegExp.$1, (RegExp.$1.length==1) ? (o[k]) : (("00"+ o[k]).substr((""+ o[k]).length)));   
  return fmt;   
}
var url = '';
if(window.location.href.indexOf('localhost')>-1||window.location.href.indexOf('t-dist')>-1){
    url = 'http://t-dist.green-stone.cn';
  }else{
    url = 'http://dist.green-stone.cn';
  }
var asn = getUrlParams('asn');
var at = getUrlParams('at');
console.log(at)
if(at == 'android'){
  $('.container_ios_tips').hide();
}

// 获取app下载信息
// asn : appShortName   string   app名缩写  例如 jysd
// at: appType  string   app类型  例如 android   或  IOS
// adlid: adlid int app信息ID
// an：appName String app名称
// asn：appShortName String app简称
// at：appType String app类型  android  IOS
// alu：applogoUrl String app logo URL
// ver：version String app版本
// as：appSize String app大小
// dlu：downLoadUrl String app下载地址
// ad：appDesc String app描述
// qc：QRCode String app二维码
// wu：WebUrl String web页地址
// ut：UpdateTime String app更新时间



$.ajax({
  type: 'get',
  url: url+'/comm/GetAppDownLoadInfo.do?asn='+asn+'&at='+at,
  success: function(data) {
      //alert('wxscan:' + JSON.stringify(data));
      if (data.c == 1000) {
        console.log(data);
        // alert(data.dlu);
        // 下载app的logo
        $('.container_logo img').attr('src',data.alu);
        // 下载系统是安卓还是ios
        if(data.at == 'android'){
          $('.container_name img').attr('src','image/appDownloadAndroid.png');
        }else{
          $('.container_name img').attr('src','image/appDownloadIos.jpg');
        }
        // 下载app的名称
        $('.container_name_appname').text(data.an);
        // 下载app的版本号
        $('.container_describe_cersion').text(data.ver);
        // 下载app的大小
        $('.container_describe_size').text(data.as);
        // 下载app的更新时间
        $('.container_describe_time').text(new Date(data.ut).Format('yyyy-MM-dd'));
        // 下载app的二维码
        // $('.container_qrcode img').attr('src',data.qc);
        // 下载app的地址
        $('.container_downloadUrl').text(data.dlu)
      }
  },
  error: function() {
      alert('系统开了小差，请刷新页面');
  }
});




// 安装app


  $('.container_install').on('click' , function(){
    // 判断浏览器类型
    var browser = {
      versions: function () {
        var u = navigator.userAgent, app = navigator.appVersion;
        return {   //移动终端浏览器版本信息
          trident: u.indexOf('Trident') > -1, //IE内核
          presto: u.indexOf('Presto') > -1, //opera内核
          webKit: u.indexOf('AppleWebKit') > -1, //苹果、谷歌内核
          gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') == -1, //火狐内核
          mobile: !!u.match(/AppleWebKit.*Mobile.*/), //是否为移动终端
          ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
          android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或uc浏览器
          iPhone: u.indexOf('iPhone') > -1, //是否为iPhone或者QQHD浏览器
          iPad: u.indexOf('iPad') > -1, //是否iPad
          webApp: u.indexOf('Safari') == -1 //是否web应该程序，没有头部与底部
        };
      }(),
      language: (navigator.browserLanguage || navigator.language).toLowerCase()
    }
    //判断是否是移动设备打开。browser代码在下面
    console.log(browser.versions.ios)
    console.log(browser.versions.android)
    console.log(at)
    console.log(navigator.userAgent.toLowerCase());
    var ua = navigator.userAgent.toLowerCase();
    if(!browser.versions.mobile){
      alert('请在手机上使用浏览器打开本页面!');
      return;
    }else if(browser.versions.ios && at === 'android'){
      alert('您的手机是iOS系统，无法安装Android应用!')
      return;
    }else if(browser.versions.android && at === 'ios'){
      alert('您的手机是Android系统，无法安装iOS应用!');
      return;
    }else if(/micromessenger/i.test(ua) || typeof navigator.wxuserAgent !== 'undefined'){
      alert('请点击微信右上角按钮，然后在弹出的菜单中，点击在浏览器中打开，即可下载');
    }else{
      window.location.href = $('.container_downloadUrl').text();
    }
    


  })
  



  

</script>
</body>
