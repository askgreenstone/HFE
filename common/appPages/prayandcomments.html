<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
  <title>点赞评论</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width,height=device-height,user-scalable=no,initial-scale=1">
  <meta name="x5-orientation" content="portrait">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <style type="text/css">
  	html,body{
  		width: 100%;
  		height: 100%;
  	}
  	*{
  		margin: 0;
  		padding: 0;
  	}
  	.wrap{
  		width: 100%;
  		height: 100%;
  		background: #eee;
  	}
  	.lawyer{
  		width: 100%;
  		background: #fff;
  		box-sizing: border-box;
  		font-size: 1.4rem;
  		color: #333;
  	}
  	.lawyer_box{
  		width: 100%;
  		margin-bottom: 1rem;
  	}
    .lawyer_box img{
      display: block;
      border-radius: 50%;
      margin: 1rem auto;
    }
    .lawyer_content{
      width: 100%;
      padding: 0 30%;
      box-sizing: border-box;
      display: box;
      display: -webkit-box;
    }
    .lawyer_content div{
      -webkit-box-flex: 1;
      margin-bottom: 2rem;
    }
    .lawyer_content div img{
      width: 60%;
      display: block;
      margin: 1rem auto;
    }
    .lawyer_content div span{
      widows: 100%;
      display: block;
      height: 2rem;
      text-align: center;
      line-height: 2rem;
      color: #4d4d4d;
    }
    .lawyer_source{
      width: 100%;
      height: 3rem;
      line-height: 3rem;
      color: #878787;
      background: #f8f8f8;
      text-align: center;
      font-size: 1.2rem;
    }
  	.praise{
  		width: 100%;
  		display: box;
  		display: -webkit-box;
      padding: 1.8rem;
      box-sizing: border-box;
      background: #fff;
  	}
  	.praise_left{
  		width: 50px;
      height: 50px;
  	}
    .praise_left img{
      margin: 1px;
    }
  	.praise_right{
  		width: 90%;
  	}
  	.praise_right img{
  		margin: 1px;
  	}
    .blank{
      width: 100%;
      height: 1.2rem;
      background: #f8f8f8;
    }
  	.comment_list{
  		width: 100%;
      background: #fff;
      padding: 1.8rem;
      box-sizing: border-box;
  	}
  	.comment_list li{
  		width: 100%;
  		display: box;
  		display: -webkit-box;
  		margin-bottom: 0.5rem;
  	}
    .list_top{
      border-top: 1px solid #ccc;
      padding-top: 1rem;
    }
  	.list_left{
      border-radius: 50%;
      display: block;
      width: 4rem;
      height: 4rem;
      margin-right: 1rem;
  	}
  	.list_right{
  		-webkit-box-flex: 1;
  	}
  	.list_right_name{
  		height: 3rem;
      line-height: 3rem;
      color: #000;
      font-size: 1.6rem;
      display: block;
  	}
  	.list_right_date{
  		height: 2rem;
      line-height: 2rem;
      display: block;
      color: #878787;
  	}
  	.list_right_con{
  		width: 100%;
      line-height: 2rem;
      font-size: 1.4rem;
      color: #4b4b4b;
      box-sizing: border-box;
      margin: -0.5rem 0 0.5rem;
      word-break: break-word;
  	}
    .list_right_con pre{
      white-space: pre-wrap;
    }
  	/*适配手机*/
		@media screen and (max-width: 360px) {
		  html {
		    font-size: 62.5%;
		  }
		}
		@media screen and (min-width: 361px) and (max-width: 376px) {
		  html {
		    font-size: 66.5%;
		  }
		}
		@media screen and (min-width: 377px) {
		  html {
		    font-size: 75.5%;
		  }
		}

  </style>
</head>
<body>
	<div class="wrap">
		<div class="lawyer">
			<div class="lawyer_box">
        <img width="70" height="70" class="lawyer_head" src="image/head.png">
			</div>
      <div class="lawyer_content">
        <div id="gotoMicroweb"><img src="image/personal.png" /><span>ta的名片</span></div>
        <div id="register"><img src="image/regist.png" /><span>我要注册</span></div>
      </div>
		</div>
    <div class="lawyer_source"><span id="sourceType"></span><span id="lawyerName"></span> 律师收到的赞</div>
		<div class="praise">
			<div class="praise_left">
				<img src="image/zan.png" width="48" height="48"> 
			</div>
			<div class="praise_right">
				
			</div>
		</div>
    <div class="blank"></div>
		<ul class="comment_list">
			
		</ul>
	</div>
	<script type="text/javascript" src="lib/jquery.min.js"></script>
	<script type="text/javascript" src="js/common.js"></script>
	<script type="text/javascript">
		var ownUri;
		var status;
    var st;
		$(document).ready(function() {
		  init();
		});


		function init(){
		  ownUri = Common.getUrlParam('ownUri');
		  status = Common.getUrlParam('status');
      st = Common.getUrlParam('st');
		  console.log(status);
		  // 状态码  1显示律师信息  0隐藏
      // sourceFrom 区分来源  在线法律平台传1，公众号传2，工作室传3，全部来源传0
		  if(status == 0){
		  	$('.lawyer').hide();
		  }else{
		  	$('.lawyer').show();
		  }
      if(st == 1){
        $('#sourceType').text('通过【在线法律平台】平台 ');
      }else if(st == 2){
        $('#sourceType').text('通过 公众号 ');
      }else if(st == 3){
        $('#sourceType').text('通过 工作室 ');
      }else{
        $('#sourceType').text('');
      }
		  getUsrComment();
		  $('#register').bind('click',function(){
		  	window.location.href = Common.globalDistUrl() + 'coop/wbms/view/wxtemplate.html'
		  })
		  $('#gotoMicroweb').bind('click',function(){
		  	window.location.href = Common.globalDistUrl() + 'usr/ThirdHomePage.do?ownUri='+ownUri;
		  })
		}


		// 获取用户点赞头像和评论
		function getUsrComment(){
			$.ajax({
		    type: 'GET',
		    url: Common.globalDistUrl() + 'usr/ExpertRaiseAndEvaluate.do?ou='+ownUri+'&st='+st,
		    success: function(data) {
		        //alert( 'success:' + JSON.stringify(data) );
		        console.log(data);
		        if(data.c ==1000){
		        	var html = ''
		        	var str = ''
              // 专家头像
              $('.lawyer_head').attr({
                src: data.res.ep?(Common.globalTransferUrl()+data.res.ep):(Common.globalTransferUrl()+'header.jpg')
              });
              // 点赞头像列表
		        	if(data.res.rl.length>0){
		        		for(var i=0;i<data.res.rl.length;i++){
		        			var img = data.res.rl[i].p?Common.globalTransferUrl()+data.res.rl[i].p:Common.globalTransferUrl()+'header.jpg';
			        		html += '<img src="'+img+'" width="48" height="48">'
			        	}
		        	}else{
		        		$('.praise').hide();
		        	}
              // 评论列表
		        	if(data.res.el.length>0){
		        		for(var k=0;k<data.res.el.length;k++){
			        		var img = data.res.el[k].p?Common.globalTransferUrl()+data.res.el[k].p:Common.globalTransferUrl()+'header.jpg';
                  if(k == 0){
                    str += '<li>'
                      + '<img class="list_left" src="'+img+'"/>'
                      + '<div class="list_right">'
                      + '<div class="list_right_name">'+data.res.el[k].nm+'</div>'
                      + '<div class="list_right_date">'+formatDate(data.res.el[k].ts)+'</div>'
                      + '<div class="list_right_con"><pre>'+data.res.el[k].c+'</pre></div></div></li>'
                  }else{
                    str += '<li class="list_top">'
                      + '<img class="list_left" src="'+img+'"/>'
                      + '<div class="list_right">'
                      + '<div class="list_right_name">'+data.res.el[k].nm+'</div>'
                      + '<div class="list_right_date">'+formatDate(data.res.el[k].ts)+'</div>'
                      + '<div class="list_right_con"><pre>'+data.res.el[k].c+'</pre></div></div></li>'
                  }
			        	}
		        	}else{
		        		$('.comment').hide();
		        	}
		        	
		        	console.log(html);
		        	console.log(str);
		        	$('.praise_right').html(html);
		        	$('.comment_list').html(str);
		        	$('#lawyerName').text(data.res.enm);
		        }
		    },
		    error: function(err) {
		      alert('网络连接错误或服务器异常！');
		    }
		  });
		}


		// 显示时间格式
		function formatDate(now)   {  
      var year = new Date(now).getFullYear();
      var month = new Date(now).getMonth()+1;     
      var date =new Date(now).getDate();     
      return year+'-'+month+"-"+date;     
    }     

    var d=new Date();     
    console.log(formatDate(d)); 

		
	</script>
</body>
</html>