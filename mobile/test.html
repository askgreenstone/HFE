<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1">
    <link rel="stylesheet" type="text/css" href="css/lib/slick/slick.css" />
    
</head>

<body>
    <div id="myapp">
    	<div class="spinner-bounce-circle">
        <div></div>
        <div></div>
    	</div>
    </div>
    <script type="text/javascript" src="public/app.js"></script>
    <script src="http://code.jquery.com/jquery-latest.js"></script>
    <script type="text/javascript" src="weixin-1.0.0.min.js"></script>
    <script type="text/javascript">

    $('#testMap').click(function(){
        getLocationInfo();
    })
    function wxSignature(x,y) {
      var currentPath = window.location.href,
          uri = encodeURIComponent(currentPath.toString()),
          ownUri = 'e1107';
      if(!ownUri) return;
      $.ajax({
          type: 'get',
          url: 'http://t-dist.green-stone.cn/usr/ThirdJSapiSignature.do?apath=' + uri+'&ownUri='+ownUri,
          success: function(data) {
              alert('ThirdJSapiSignature:' + JSON.stringify(data));
              if (data.c == 1000) {
                  wx.config({
                      debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
                      appId: data.appId, // 必填，公众号的唯一标识
                      timestamp: data.timestamp, // 必填，生成签名的时间戳
                      nonceStr: data.noncestr, // 必填，生成签名的随机串
                      signature: data.signature, // 必填，签名，见附录1
                      jsApiList: ['openLocation'] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
                  });

                  wx.ready(function() {
                      wx.checkJsApi({
                          jsApiList: ['openLocation'], // 需要检测的JS接口列表，所有JS接口列表见附录2,
                          success: function(res) {
                            alert(JSON.stringify(res));
                              // 以键值对的形式返回，可用的api值true，不可用为false
                              // 如：{"checkResult":{"chooseImage":true},"errMsg":"checkJsApi:ok"}
                          }
                      });
                      alert('openLocation:'+y+'-----'+x);
                      wx.openLocation({
                          latitude: '39.963019', // 纬度，浮点数，范围为90 ~ -90
                          longitude: '116.44961', // 经度，浮点数，范围为180 ~ -180。
                          name: '办公地址', // 位置名
                          address: '北京市朝阳区时间国际4号楼', // 地址详情说明
                          scale: 1, // 地图缩放级别,整形值,范围从1~28。默认为最大
                          infoUrl: '' // 在查看位置界面底部显示的超链接,可点击跳转
                      });
                      wx.getLocation({
                        success: function (res) {
                          alert(JSON.stringify(res));
                        },
                        cancel: function (res) {
                          alert('用户拒绝授权获取地理位置');
                        }
                      });
                  });

              } else {
                  alert('code:' + data.c + ',error:' + data.d);
              }
          },
          error: function(xhr, status, err) {
              alert('网络连接错误或服务器异常！');
              console.error(this.props.url, status, err.toString());
          }
      });
  }
  function getLocationInfo(){
    $.ajax({
        type: 'post',
        url: 'http://t-dist.green-stone.cn/comm/QQMapLocation.do',
        data: JSON.stringify({
            'region': '北京',
            'address':'北京市昌平区天通苑西三区'
        }),
        success: function(data) {
            alert(JSON.stringify(data));
            // console.log(JSON.stringify(data));
            // alert('lng:'+data.result.location.lng+'---'+'lat:'+data.result.location.lat);
            wxSignature(data.result.location.lat,data.result.location.lng);
        },
        error: function(xhr, status, err) {
            alert('getLocationInfo error:' + JSON.stringify(xhr));
            console.error(this.props.url, status, err.toString());
        }
    });
  }
    </script>
</body>

</html>
